
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>AutoBuy NFT via Telegram</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #status { margin-top: 20px; font-size: 1.1em; }
    code { background-color: #eee; padding: 2px 4px; border-radius: 3px; }
  </style>
</head>
<body>
  <h2>AutoBuy NFT via Telegram</h2>
  <div id="status">⏳ Waiting for initData...</div>

  <script>
    async function runAutoBuy() {
      const status = document.getElementById("status");

      // Отримуємо initData автоматично з Telegram WebView
      const initData = window.Telegram?.WebApp?.initData;

      if (!initData) {
        status.innerHTML = "❌ <b>initData not found</b>.<br>Будь ласка, відкрий цей WebApp через Telegram бота.";
        return;
      }

      status.innerHTML = "✅ initData отримано. <code>sending request...</code>";

      const collectionId = 2;
      const characterId = 19;
      const currency = "USDT";
      const count = 1;

      const apiUrl = `https://api.stickerdom.store/api/v1/shop/buy/crypto?collection=${collectionId}&character=${characterId}&currency=${currency}&count=${count}`;

      try {
        const res = await fetch(apiUrl, {
          method: "POST",
          headers: {
            "Accept": "application/json",
            "X-Telegram-InitData": initData,
            "Origin": "https://stickerdom.store"
          }
        });

        if (res.ok) {
          const data = await res.json();
          const link = data?.data?.payment?.link;
          if (link) {
            status.innerHTML = "✅ Відкриваємо Telegram Wallet...";
            window.open(link, "_blank");
          } else {
            status.innerHTML = "⚠️ Запит пройшов, але немає посилання на оплату.";
          }
        } else {
          const errText = await res.text();
          status.innerHTML = "❌ Запит не вдався: <code>" + errText + "</code>";
        }
      } catch (e) {
        status.innerHTML = "❌ Error: <code>" + e.message + "</code>";
      }
    }

    window.onload = runAutoBuy;
  </script>
</body>
</html>
