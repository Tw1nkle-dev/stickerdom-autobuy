
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>AutoBuy NFT via Telegram</title>
  <script>
    async function runAutoBuy() {
      const status = document.getElementById("status");
      status.textContent = "⏳ Getting initData from Telegram...";

      // Get initData from the URL
      const urlParams = new URLSearchParams(window.location.search);
      const initData = urlParams.get("initData");

      if (!initData) {
        status.textContent = "❌ initData not found. Please open this page via Telegram.";
        return;
      }

      status.textContent = "✅ initData received. Sending buy request...";

      const collectionId = 2;
      const characterId = 19;
      const currency = "USDT";
      const count = 1;

      const apiUrl = `https://api.stickerdom.store/api/v1/shop/buy/crypto?collection=${collectionId}&character=${characterId}&currency=${currency}&count=${count}`;

      try {
        const res = await fetch(apiUrl, {
          method: "POST",
          headers: {
            "Accept": "application/json",
            "X-Telegram-InitData": initData,
            "Origin": "https://stickerdom.store"
          }
        });

        if (res.ok) {
          const data = await res.json();
          const link = data?.data?.payment?.link;
          if (link) {
            status.textContent = "✅ Opening Telegram Wallet...";
            window.open(link, "_blank");
          } else {
            status.textContent = "⚠️ Request succeeded but no payment link returned.";
          }
        } else {
          const err = await res.text();
          status.textContent = "❌ Buy failed: " + err;
        }
      } catch (e) {
        status.textContent = "❌ Error: " + e.message;
      }
    }

    window.onload = runAutoBuy;
  </script>
</head>
<body>
  <h2>AutoBuy NFT via Telegram</h2>
  <p id="status">Loading...</p>
</body>
</html>
